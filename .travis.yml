language: ruby
rvm:
- 2.5.3
bundler_args: --without development
sudo: false
cache:
  bundler: true
  yarn: true
  directories:
  - tmp/solr_dl/
env:
  global:
  - RAILS_ENV=test

before_install:
- gem update --system
- gem install bundler

before_script:
- bundle exec rails docker:pull
- bundle exec rails docker:run_ci
- bundle exec rails docker:build
- bundle exec rails assets:precompile

script:
- bundle exec niftany
- bundle exec rake
